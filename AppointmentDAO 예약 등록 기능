 // [기능 1] 예약 등록

    public void register(String pName, String phone, String dName, String appDate) {
        if (appDate.length() == 16) appDate += ":00";

        String findPatientSql = "SELECT patient_id FROM patients WHERE patient_name = ? AND phone = ?";
        String findDoctorSql = "SELECT doctor_id FROM doctors WHERE doctor_name = ? LIMIT 1";
        String checkSql = "SELECT COUNT(*) FROM appointments WHERE doctor_id = ? AND app_date = ? AND situation = '예약완료'";
        String insertSql = "INSERT INTO appointments (patient_id, doctor_id, app_date, situation) VALUES (?, ?, ?, '예약완료')";

        try (Connection conn = getConnection()) {
            // 1. 환자 확인
            int pId = -1;
            try (PreparedStatement pstmt = conn.prepareStatement(findPatientSql)) {
                pstmt.setString(1, pName);
                pstmt.setString(2, phone);
                ResultSet rs = pstmt.executeQuery();
                if (rs.next()) pId = rs.getInt("patient_id");
                else {
                    System.out.println("등록되지 않은 환자 정보입니다.");
                    return;
                }
            }

            // 2. 의사 확인
            int dId = -1;
            try (PreparedStatement pstmt = conn.prepareStatement(findDoctorSql)) {
                pstmt.setString(1, dName);
                ResultSet rs = pstmt.executeQuery();
                if (rs.next()) dId = rs.getInt("doctor_id");
                else {
                    System.out.println("존재하지 않는 의사 이름입니다.");
                    return;
                }
            }

            // 3. 중복 체크
            try (PreparedStatement pstmt = conn.prepareStatement(checkSql)) {
                pstmt.setInt(1, dId);
                pstmt.setString(2, appDate);
                ResultSet rs = pstmt.executeQuery();
                if (rs.next() && rs.getInt(1) > 0) {
                    System.out.println("해당 시간대에 의사 ["+dName+"]님은 이미 예약이 완료되었습니다.");
                    return;
                }
            }

            // 4. 등록
            try (PreparedStatement pstmt = conn.prepareStatement(insertSql)) {
                pstmt.setInt(1, pId);
                pstmt.setInt(2, dId);
                pstmt.setString(3, appDate);
                pstmtInsert(pstmt, pName, dName);
            }
        } catch (SQLException e) {
            System.err.println("DB 오류: " +e.getMessage());
        }
    }

    private void pstmtInsert(PreparedStatement pstmt, String pName, String dName) throws SQLException {
        pstmt.executeUpdate();
        System.out.println("["+pName+"]님, ["+dName+"] 의사에게 예약이 완료되었습니다.");
    }
